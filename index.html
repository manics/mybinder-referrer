<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>mybinder referrer</title>
    <style>
      body {
        font-family: Arial, Helvetica, sans-serif;
      }
      .source {
        font-size: 70%;
      }
    </style>
    <script type="text/javascript">
      var url = document.referrer;

      function setreferrerurl() {
        document.getElementById("mybinder-referrer").value = url;
        setbinderurl();
      }

      function setbinderurl() {
        var url = document.getElementById("mybinder-referrer").value;
        var regexes = [
            /\w+:\/\/(gist.github.com)\/([^\/]+)\/([^\/]+)/,
            /\w+:\/\/(github.com)\/([^\/]+)\/([^\/]+)(\/tree\/([^\/]+))?/,
        ]
        var m;
        for (let i = 0; i < regexes.length; i++) {
            m = regexes[i].exec(url)
            if (m) {
              break;
            }
        }
        var mybinder = []
        if (m) {
            if (m[1] == "gist.github.com") {
              mybinderurl = "https://mybinder.org/v2/gist/" + m[2] + "/" + m[3] + "/master";
            }
            else if (m[1] == "github.com") {
              mybinderurl = "https://mybinder.org/v2/gh/" + m[2] + "/" + m[3];
              if (m[5]) {
                mybinderurl += "/" + m[5];
              } else {
                mybinderurl += "/master";
              }
            }

            mybinder.push(document.createTextNode("MyBinder URL: "))
            var mybindera = document.createElement("a");
            mybindera.textContent = mybinderurl;
            mybindera.setAttribute("href", mybinderurl);
            mybinder.push(mybindera);
        } else {
          mybinder.push(document.createTextNode("Unable to find mybinder repo in referrer, try pasting your previous URL above."));
        }
        var binderinfo = document.getElementById("mybinder-info");
        while (binderinfo.firstChild) {
          binderinfo.firstChild.remove();
        }
        mybinder.forEach(function (e) { binderinfo.appendChild(e); });
      }
    </script>
  </head>
  <body onload="setreferrerurl();">
    <label for="mybinder-referrer">Referrer:</label>
    <input id="mybinder-referrer" size="80" value="" oninput="setbinderurl()" />
    <p id="mybinder-info"></p>

    <p class="source"><a href="https://github.com/manics/mybinder-referrer/">View source on GitHub.</a></p>
  </body>
</html>


